---
title: HTTPS Outcalls
description: HTTPS Outcalls enable canisters to make HTTPS requests to Web2 APIs
---

## Summary

The canister HTTPS outcalls feature is implemented as part of the Internet Computer replica and is exposed as an API of the management canister. It enables canisters to make HTTPS requests to Web2 APIs without relying on off-chain services.

## Implementation

When a replica is started, a `CanisterHttpAdapterClientImpl` is initialized while [constructing the IC stack](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/replica/src/setup_ic_stack.rs#L260C5-L268C7). The [client](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/client/src/client.rs#L52C1-L61C2) has a [send](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/client/src/client.rs#L91C4-L91C4) method which uses a channel to enqueue a request that will be sent to the canister http adapter.

In this phase, the consensus and p2p layers are also [setup](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/replica/setup_ic_network/src/lib.rs#L133). In particular, after [enabling the new p2p for HTTP outcalls](https://github.com/dfinity/ic/commit/f3174d5), an artifact processor dedicated to handling `CanisterHTTPArtifact`s is [created](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/artifact_manager/src/lib.rs#L529C5-L535C7) and the corresponding [HTTPS outcalls client](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/replica/setup_ic_network/src/lib.rs#L824C5-L879C7) is [added](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/replica/setup_ic_network/src/lib.rs#L333C9-L338C11) to the [new p2p consensus](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/replica/setup_ic_network/src/lib.rs#L207C5-L211C7). The new p2p is then [run](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/p2p/consensus_manager/src/lib.rs#L93C5-L101C6) by [starting the consensus manager](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/p2p/consensus_manager/src/lib.rs#L69C9-L83C1) with the new [QUIC transport](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/replica/setup_ic_network/src/lib.rs#L380C5-L392C1) and the [topology watcher](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/replica/setup_ic_network/src/lib.rs#L366C5-L374C1).

<!-- The consensus manager runs two event loops, one for adverts that have to be [sent](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/p2p/consensus_manager/src/sender.rs#L80C5-L111C6) and the other for adverts [received](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/p2p/consensus_manager/src/receiver.rs#L226C5-L279C6) from peers. -->

The [processor](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/artifact_manager/src/lib.rs#L529C5-L535C7) of `CanisterHttpArtifact`s is used in a [thread loop](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/artifact_manager/src/lib.rs#L262C1-L313C2) which [processes the changes](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/artifact_manager/src/processors.rs#L45C5-L70C6) due to the arrival of new artifacts, [inserts](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/artifact_pool/src/canister_http_pool.rs#L105C5-L107C6) them in the unvalidated section of the `CanisterHttpPoolImpl`, and [applies](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/artifact_pool/src/canister_http_pool.rs#L113C5-L159C6) the changes to the pool. The changes are obtained from the `change_set_producer`, which in case of the HTTP processor is the [CanisterHttpPoolManagerImpl](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/consensus/src/pool_manager.rs#L34C1-L52C2).

When the [on_state_change](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/consensus/src/pool_manager.rs#L377C5-L387C6) method of the `change_set_producer` is [called](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/artifact_manager/src/processors.rs#L66C26-L68C58), the change set is generated by first [making the requests](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/consensus/src/pool_manager.rs#L350C13-L350C56) and then [creating shares](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/consensus/src/pool_manager.rs#L353C13-L353C84) from the responses that are currently available.

When making requests, the `CanisterHttpPoolManagerImpl` checks for [http requests in the replicated state](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/consensus/src/pool_manager.rs#L156C9-L163C22) of the subnet and checks the pool to see which [requests have already been made](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/consensus/src/pool_manager.rs#L169C9-L184C1). Each new request is then [sent](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/consensus/src/pool_manager.rs#L188C35-L196C23) to the HTTP adapter shim, which is none other than the `CanisterHttpAdapterClientImpl`. This triggers its [send](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/client/src/client.rs#L88C5-L253C6) method that [sends the request](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/client/src/client.rs#L144C13-L163C19) via a [Unix socket](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/client/src/lib.rs#L49C21-L53C29) to the [canister HTTP adapter](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/adapter/src/rpc_server.rs#L37C1-L42C2), which is sandboxed into a separate OS-level process for security reasons.

The HTTP adapter makes the request and returns a response back to the replica, which [transforms](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/client/src/client.rs#L192C29-L198C36) it according to the [transformation function](https://internetcomputer.org/docs/current/developer-docs/integrations/https-outcalls/https-outcalls-how-it-works#transformation-function) specified by the developer. The transformed HTTP response is [sent](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/client/src/client.rs#L233C13-L250C16) via the internal [channel](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/client/src/client.rs#L72C9-L72C51) of the HTTP adapter shim, which the`CanisterHttpPoolManagerImpl` [keeps trying to read from](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/consensus/src/pool_manager.rs#L229C9-L261C10) when [creating shares from responses](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/consensus/src/pool_manager.rs#L209C5-L263C6). Once a response is received, a [share](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/consensus/src/pool_manager.rs#L233C21-L255C23) which uniquely identifies the response is created and inserted in the [change set](https://github.com/dfinity/ic/blob/7f6e7df37690a4256066a6bc0a55c8eb595f7755/rs/https_outcalls/consensus/src/pool_manager.rs#L258C21-L258C96) in order to be added to the validated section of the HTTP artifact pool.

Once this artifact is then inserted in the payload of a block proposal and that block becomes finalized, the canister finally receives the HTTP response.

<!--
The lifecycle of an HTTPS outcall is the following:

1. A canister makes an outgoing HTTP request by calling the management canister API using the `http_request` method.
2. The request is stored temporarily in the replicated state of the subnet.
3. Periodically (each round) an **adapter** at the networking layer in each replica fetches the pending HTTP outcalls from replicated state. (In fact, a ‘shim’ layer of the adapter that is inside the replica process does so as the adapter itself is sandboxed into a separate OS-level process for security reasons.)
4. The adapter on each replica executes the HTTP request by sending it to the target server.
5. The corresponding HTTP response from the server is received by the adapter on each replica of the subnet and provided to a component in the replica process. The adapter limits the network response size to `max_response_bytes` which defaults to 2 MB and can be set to lower values. It is important to set this as low as reasonably possible for the expected response as it affects the price of the request: The price increases with the size `max_response_bytes` and the actual response size is not considered, only the maximum.
6. An optional transformation function implemented as part of the canister is invoked on the respective response on each replica to transform the response. This is done by a component within the replica process.
7. The transformed response is handed over to consensus on each replica.
8. ICP consensus agrees on a response if at least 2f+1 have the same response for the request as input, where f is the number of faulty replicas tolerated by the protocol of the replicas. In this case, consensus provides this response back to the management canister API, or an error if no consensus can be reached or in case of other problems.
9. The management canister API provides the response or error back to the calling canister. -->
